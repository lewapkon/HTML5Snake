{"ts":1371066172332,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"snake.board = (function() {\n\tvar settings,\n\t\tcols,\n\t\trows,\n\t\tbaseScore,\n\t\trotation,\n\t\trotated = false,\n\t\tstartX, startY,\n\t\tbonusX, bonusY, bonus,\n\t\tboard, snakes,\n\t\tscore,\n\t\tdisplay = snake.display,\n\t\ttime = 0, counter = 0,\n\t\tdom = snake.dom,\n\t\t$ = dom.$;\n\t\n\t/* funkcje gry */\n\tfunction initialize(startSnake, callback) {\n\t\tsettings = snake.settings;\n\t\tbaseScore = settings.baseScore;\n\t\tcols = settings.cols;\n\t\trows = settings.rows;\n\t\tif (!startSnake) {\n\t\t\tstartX = Math.floor(cols/2);\n\t\t\tstartY = Math.floor(rows/2);\n\t\t\tgenerateSnake();\n\t\t} else {\n\t\t\tstartX = snakes[0].X;\n\t\t\tstartY = snakes[0].Y;\n\t\t}\n\t\tcallback();\n\t}\n\tfunction changeTime() {\n\t\ttime++;\n\t\tvar minutes = 0,\n\t\t\tseconds = 0;\n\t\tminutes = Math.floor(time / 60);\n\t\tseconds = time % 60;\n\t\tif (seconds < 10) {\n\t\t\tseconds = 0 + \"\" + seconds;\n\t\t}\n\t\t$(\"#game-screen .time span\")[0].innerHTML = minutes + \":\" + seconds;\n\t}\n\tfunction generateSnake() {\n\t\trotation = Math.floor(Math.random()*4);\n\t\tscore = 0;\n\t\tsnakes = [];\n\t\tboard = [];\n\t\t\n\t\tfor (var x = 0; x < cols; x++) {\n\t\t\tboard[x] = [];\n\t\t\tfor (var y = 0; y < rows; y++) {\n\t\t\t\tboard[x][y] = 6;\n\t\t\t}\n\t\t}\n\t\tsnakes.unshift({X : startX, Y : startY, rot : rotation});\n\t\tboard[snakes[0].X][snakes[0].Y] = 0;\n\t\trndBonus();\n\t}\n\tfunction rndBonus() {\n\t\tdo {\n\t\t\tbonusX = Math.floor(Math.random() * cols);\n\t\t\tbonusY = Math.floor(Math.random() * rows);\n\t\t} while (board[bonusX][bonusY] != 6);\n\t\t\n\t\tbonus = {\n\t\t\tX : bonusX,\n\t\t\tY : bonusY,\n\t\t\ttype : Math.random() > 0.95 ? 5 : 4\n\t\t};\n\t\tboard[bonus.X][bonus.Y] = bonus.type;\n\t}\n\tfunction checkBonus(x, y) {\n\t\tif (getField(x, y) == 4 || getField(x, y) == 5) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\tfunction getField(x, y) {\n\t\tif (x < 0 || x > cols - 1 || y < 0 || y > rows - 1) {\n\t\t\treturn -2;\n\t\t} else {\n\t\t\treturn board[x][y];\n\t\t}\n\t}\n\tfunction checkField(x, y) {\n\t\tif (getField(x, y) == 6 || getField(x, y) == 4 || getField(x, y) == 5) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\tfunction goHelper(x, y) {\n\t\tif (checkField(x, y)) {\n\t\t\tif (checkBonus(x, y)) {\n\t\t\t\tscore += baseScore;\n\t\t\t\t$(\"#game-screen .score span\")[0].innerHTML = score;\n\t\t\t\t//bonuses.push({X : x, Y : y});\n\t\t\t\trndBonus();\n\t\t\t\treturn 2;\n\t\t\t} else {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t}\n\t\treturn 0;\n\t}\n\tfunction go() {\n\t\tvar helper;\n\t\trotated = false;\n\t\tswitch (rotation) {\n\t\t\tcase 0:\n\t\t\t\thelper = goHelper(startX, startY - 1);\n\t\t\t\tif (helper > 0) {\n\t\t\t\t\tsnakes.unshift({X : startX, Y : --startY, rot : 0});\n\t\t\t\t\tboard[snakes[0].X][snakes[0].Y] = 3;\n\t\t\t\t\tif (helper == 1) {\n\t\t\t\t\t\tboard[snakes[snakes.length - 1].X][snakes[snakes.length - 1].Y] = 6;\n\t\t\t\t\t\tsnakes.pop();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 1:\n\t\t\t\thelper = goHelper(startX + 1, startY);\n\t\t\t\tif (helper > 0) {\n\t\t\t\t\tsnakes.unshift({X : ++startX, Y : startY, rot : 1});\n\t\t\t\t\tboard[snakes[0].X][snakes[0].Y] = 3;\n\t\t\t\t\tif (helper == 1) {\n\t\t\t\t\t\tboard[snakes[snakes.length - 1].X][snakes[snakes.length - 1].Y] = 6;\n\t\t\t\t\t\tsnakes.pop();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\thelper = goHelper(startX, startY + 1);\n\t\t\t\tif (helper > 0) {\n\t\t\t\t\tsnakes.unshift({X : startX, Y : ++startY, rot : 2});\n\t\t\t\t\tboard[snakes[0].X][snakes[0].Y] = 3;\n\t\t\t\t\tif (helper == 1) {\n\t\t\t\t\t\tboard[snakes[snakes.length - 1].X][snakes[snakes.length - 1].Y] = 6;\n\t\t\t\t\t\tsnakes.pop();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\t\thelper = goHelper(startX - 1, startY);\n\t\t\t\tif (helper > 0) {\n\t\t\t\t\tsnakes.unshift({X : --startX, Y : startY, rot : 3});\n\t\t\t\t\tboard[snakes[0].X][snakes[0].Y] = 3;\n\t\t\t\t\tif (helper == 1) {\n\t\t\t\t\t\tboard[snakes[snakes.length - 1].X][snakes[snakes.length - 1].Y] = 6;\n\t\t\t\t\t\tsnakes.pop();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t}\n\t\tif (helper > 0 && snakes.length > 1) {\n\t\t\tif (board[snakes[1].X][snakes[1].Y] == 3) {\n\t\t\t\tboard[snakes[1].X][snakes[1].Y] = 0;\n\t\t\t}\n\t\t}\n\t\tif (helper == 0) {\n\t\t\t// Przegrałeś\n\t\t\tboard[snakes[0].X][snakes[0].Y] = 3;\n\t\t\trotated = true;\n\t\t\tsnake.screens[\"game-screen\"].gameOver();\n\t\t\treturn;\n\t\t}\n\t\t//print();\n\t\tdisplay.redraw(getBoard(), getSnakes());\n\t\tif (++counter == 5) {\n\t\t\tcounter = 0;\n\t\t\tchangeTime();\n\t\t}\n\t\tsnake.screens[\"game-screen\"].saveGameData();\n\t}\n\tfunction turnLeft() {\n\t\tif (!rotated) {\n\t\t\tif (--rotation < 0)\trotation = 3;\n\t\t\trotated = true;\n\t\t\tboard[snakes[0].X][snakes[0].Y] = 2;\n\t\t\t//snakes[0].rot -= 1;\n\t\t\tif (snakes[0].rot < 0) snakes[0].rot = 3;\n\t\t}\n\t}\n\tfunction turnRight() {\n\t\tif (!rotated) {\n\t\t\tif (++rotation > 3)\trotation = 0;\n\t\t\trotated = true;\n\t\t\tboard[snakes[0].X][snakes[0].Y] = 1;\n\t\t\t//snakes[0].rot += 1;\n\t\t\tif (snakes[0].rot > 3) snakes[0].rot = 0;\n\t\t}\n\t}\n\tfunction print() {\n\t\tvar str = \"\";\n\t\tfor (var y = 0; y < rows; y++) {\n\t\t\tfor (var x = 0; x < cols; x++) {\n\t\t\t\tstr += getField(x, y) + \" \";\n\t\t\t}\n\t\t\tstr += \"\\r\\n\";\n\t\t}\n\t\tconsole.log(str);\n\t\tconsole.log(\"Score: \" + score);\n\t}\n\tfunction getBoard() {\n\t\treturn board;\n\t}\n\tfunction setBoard(newBoard) {\n\t\tboard = newBoard;\n\t}\n\tfunction getSnakes() {\n\t\treturn snakes;\n\t}\n\tfunction setSnakes(newSnakes) {\n\t\tsnakes = newSnakes;\n\t}\n\tfunction getBonus() {\n\t\treturn bonus;\n\t}\n\tfunction setBonus(newBonus) {\n\t\tbonus = newBonus;\n\t}\n\tfunction getScore() {\n\t\treturn score;\n\t}\n\tfunction setScore(newScore) {\n\t\tscore = newScore;\n\t}\n\tfunction getTime() {\n\t\treturn time;\n\t}\n\tfunction setTime(newTime) {\n\t\ttime = newTime;\n\t}\n\tfunction getRotation() {\n\t\treturn rotation;\n\t}\n\tfunction setRotation(newRotation) {\n\t\trotation = newRotation;\n\t}\n\tfunction getRotated() {\n\t\treturn rotated;\n\t}\n\tfunction setRotated(newRotated) {\n\t\trotated = newRotated;\n\t}\n\tfunction getCounter() {\n\t\treturn counter;\n\t}\n\tfunction setCounter(newCounter) {\n\t\tcounter = newCounter;\n\t}\n\treturn {\n\t\tinitialize : initialize,\n\t\tgo : go,\n\t\tturnLeft : turnLeft,\n\t\tturnRight : turnRight,\n\t\tprint : print,\n\t\tgetBoard : getBoard,\n\t\tgetSnakes : getSnakes,\n\t\tgetBonus : getBonus,\n\t\tgetScore : getScore,\n\t\tgetTime : getTime,\n\t\tgetRotation : getRotation,\n\t\tgetRotated : getRotated,\n\t\tgetCounter : getCounter,\n\t\tsetBoard : setBoard,\n\t\tsetSnakes : setSnakes,\n\t\tsetBonus : setBonus,\n\t\tsetScore : setScore,\n\t\tsetTime : setTime,\n\t\tsetRotation : setRotation,\n\t\tsetRotated : setRotated,\n\t\tsetCounter : setCounter\n\t};\n})();\n"]],"start1":0,"start2":0,"length1":0,"length2":6007}]],"length":6007}
{"contributors":[],"silentsave":true,"ts":1371066236732,"patch":[[{"diffs":[[0,"y) == 4 "],[-1,"|| getField(x, y) == 5"],[0,") {\n\t\t\tr"]],"start1":1570,"start2":1570,"length1":38,"length2":16}]],"length":5985,"saved":false}
{"ts":1371066237904,"patch":[[{"diffs":[[0," y) == 4"],[-1," "],[0,") {\n\t\t\tr"]],"start1":1569,"start2":1569,"length1":17,"length2":16}]],"length":5984,"saved":false}
{"ts":1371066240609,"patch":[[{"diffs":[[0," 4) {\n\t\t\treturn "],[-1,"true"],[1,"1"],[0,";\n\t\t} else {\n\t\t\t"]],"start1":1575,"start2":1575,"length1":36,"length2":33}]],"length":5981,"saved":false}
{"ts":1371066244186,"patch":[[{"diffs":[[0,"urn 1;\n\t\t} else "],[1,"if ("],[0,"{\n\t\t\treturn fals"]],"start1":1587,"start2":1587,"length1":32,"length2":36}]],"length":5985,"saved":false}
{"ts":1371066246579,"patch":[[{"diffs":[[0,"lse if ("],[1,"getField(x, y) == 5"],[0,"{\n\t\t\tret"]],"start1":1599,"start2":1599,"length1":16,"length2":35}]],"length":6004,"saved":false}
{"ts":1371066247685,"patch":[[{"diffs":[[0," y) == 5"],[1,") "],[0,"{\n\t\t\tret"]],"start1":1618,"start2":1618,"length1":16,"length2":18}]],"length":6006,"saved":false}
{"ts":1371066253396,"patch":[[{"diffs":[[0," 5) {\n\t\t\treturn "],[-1,"false"],[1,"2"],[0,";\n\t\t}\n\t}\n\tfuncti"]],"start1":1624,"start2":1624,"length1":37,"length2":33}]],"length":6002,"saved":false}
{"ts":1371066254729,"patch":[[{"diffs":[[0,"turn 2;\n\t\t}\n"],[1,"\t\t\n"],[0,"\t}\n\tfunction"]],"start1":1635,"start2":1635,"length1":24,"length2":27}]],"length":6005,"saved":false}
{"ts":1371066255352,"patch":[[{"diffs":[[0," 2;\n\t\t}\n"],[-1,"\t\t"],[0,"\n\t}\n\tfun"]],"start1":1639,"start2":1639,"length1":18,"length2":16}]],"length":6003,"saved":false}
{"ts":1371066256643,"patch":[[{"diffs":[[0,"n 2;\n\t\t}"],[-1,"\n"],[1," else"],[0,"\n\t}\n\tfun"]],"start1":1638,"start2":1638,"length1":17,"length2":21}]],"length":6007,"saved":false}
{"ts":1371066257428,"patch":[[{"diffs":[[0,"\t\t} else"],[1," "],[0,"\n\t}\n\tfun"]],"start1":1643,"start2":1643,"length1":16,"length2":17}]],"length":6008,"saved":false}
{"ts":1371066262043,"patch":[[{"diffs":[[0,"\t} else "],[1,"{"],[0,"\n\t}\n\tfun"]],"start1":1644,"start2":1644,"length1":16,"length2":17}]],"length":6009,"saved":false}
{"ts":1371066263583,"patch":[[{"diffs":[[0," else {\n"],[1,"\t\t\tre\n\t\t}\n"],[0,"\t}\n\tfunc"]],"start1":1646,"start2":1646,"length1":16,"length2":26}]],"length":6019,"saved":false}
{"ts":1371066265092,"patch":[[{"diffs":[[0," {\n\t\t\tre"],[1,"tur"],[0,"\n\t\t}\n\t}\n"]],"start1":1651,"start2":1651,"length1":16,"length2":19}]],"length":6022,"saved":false}
{"ts":1371066267575,"patch":[[{"diffs":[[0,"\t\t\tretur"],[1,"n;"],[0,"\n\t\t}\n\t}\n"]],"start1":1654,"start2":1654,"length1":16,"length2":18}]],"length":6024,"saved":false}
{"ts":1371066273084,"patch":[[{"diffs":[[0," 2;\n"],[-1,"\t\t} else {\n\t\t\treturn;\n"],[0,"\t\t}\n"]],"start1":1639,"start2":1639,"length1":30,"length2":8}]],"length":6002,"saved":false}
{"ts":1371066282566,"patch":[[{"diffs":[[0,"core += "],[1,"checkB"],[0,"baseScor"]],"start1":2028,"start2":2028,"length1":16,"length2":22}]],"length":6008,"saved":false}
{"ts":1371066283365,"patch":[[{"diffs":[[0,"= checkB"],[1,"on"],[0,"baseScor"]],"start1":2034,"start2":2034,"length1":16,"length2":18}]],"length":6010,"saved":false}
{"ts":1371066284567,"patch":[[{"diffs":[[0,"checkBon"],[1,"us"],[0,"baseScor"]],"start1":2036,"start2":2036,"length1":16,"length2":18}]],"length":6012,"saved":false}
{"ts":1371066287800,"patch":[[{"diffs":[[0,"eckBonus"],[1,"(x, y)"],[0,"baseScor"]],"start1":2038,"start2":2038,"length1":16,"length2":22}]],"length":6018,"saved":false}
{"ts":1371066289666,"patch":[[{"diffs":[[0,"us(x, y)"],[1," * "],[0,"baseScor"]],"start1":2044,"start2":2044,"length1":16,"length2":19}]],"length":6021,"saved":false}
